-- MySQL Script generated by MySQL Workbench
-- lun. 22 f√©vr. 2016 20:36:04 CET
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema secondsense
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `secondsense` ;

-- -----------------------------------------------------
-- Schema secondsense
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `secondsense` DEFAULT CHARACTER SET utf8 ;
USE `secondsense` ;

-- -----------------------------------------------------
-- Table `secondsense`.`secondsense_scores`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `secondsense`.`secondsense_scores` ;

CREATE TABLE IF NOT EXISTS `secondsense`.`secondsense_scores` (
  `score_id` INT NOT NULL AUTO_INCREMENT,
  `high_score` INT NULL DEFAULT 0,
  `game_count` INT NULL DEFAULT 0,
  `sum_score` INT NULL DEFAULT 0,
  PRIMARY KEY (`score_id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `secondsense`.`secondsense_users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `secondsense`.`secondsense_users` ;

CREATE TABLE IF NOT EXISTS `secondsense`.`secondsense_users` (
  `facebook_user_id` VARCHAR(20) NOT NULL,
  `facebook_user_name` VARCHAR(50) NOT NULL,
  `facebook_user_profile_picture` VARCHAR(250) NULL,
  `create_time` TIMESTAMP NULL DEFAULT CURRENT_TIMESTAMP,
  `score_id` INT NULL,
  PRIMARY KEY (`facebook_user_id`),
  UNIQUE INDEX `fk_secondsense_users_secondsense_scores1_idx` (`score_id` ASC),
  CONSTRAINT `fk_secondsense_users_secondsense_scores1`
    FOREIGN KEY (`score_id`)
    REFERENCES `secondsense`.`secondsense_scores` (`score_id`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION)
ENGINE = InnoDB
ROW_FORMAT = DEFAULT;


-- -----------------------------------------------------
-- Table `secondsense`.`secondsense_friends`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `secondsense`.`secondsense_friends` ;

CREATE TABLE IF NOT EXISTS `secondsense`.`secondsense_friends` (
  `facebook_user_id` VARCHAR(20) NOT NULL,
  `facebook_user_id_friend` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`facebook_user_id`, `facebook_user_id_friend`),
  INDEX `fk_secondsense_users_has_secondsense_users_secondsense_user_idx` (`facebook_user_id_friend` ASC),
  INDEX `fk_secondsense_users_has_secondsense_users_secondsense_user_idx1` (`facebook_user_id` ASC),
  CONSTRAINT `fk_secondsense_users_has_secondsense_users_secondsense_users`
    FOREIGN KEY (`facebook_user_id`)
    REFERENCES `secondsense`.`secondsense_users` (`facebook_user_id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_secondsense_users_has_secondsense_users_secondsense_users1`
    FOREIGN KEY (`facebook_user_id_friend`)
    REFERENCES `secondsense`.`secondsense_users` (`facebook_user_id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION)
ENGINE = InnoDB
PACK_KEYS = DEFAULT
ROW_FORMAT = DEFAULT;


-- -----------------------------------------------------
-- Table `secondsense`.`secondsense_rewards`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `secondsense`.`secondsense_rewards` ;

CREATE TABLE IF NOT EXISTS `secondsense`.`secondsense_rewards` (
  `reward_id` INT NOT NULL AUTO_INCREMENT,
  `reward_name` VARCHAR(45) NOT NULL,
  `score_condition` INT NULL DEFAULT 0,
  `game_count_condition` INT NULL DEFAULT 0,
  PRIMARY KEY (`reward_id`),
  UNIQUE INDEX `reward_name_UNIQUE` (`reward_name` ASC))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `secondsense`.`secondsense_has_reward`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `secondsense`.`secondsense_has_reward` ;

CREATE TABLE IF NOT EXISTS `secondsense`.`secondsense_has_reward` (
  `reward_id` INT NOT NULL,
  `facebook_user_id` VARCHAR(20) NOT NULL,
  PRIMARY KEY (`reward_id`, `facebook_user_id`),
  INDEX `fk_secondsense_rewards_has_secondsense_users_secondsense_us_idx` (`facebook_user_id` ASC),
  INDEX `fk_secondsense_rewards_has_secondsense_users_secondsense_re_idx` (`reward_id` ASC),
  CONSTRAINT `fk_secondsense_rewards_has_secondsense_users_secondsense_rewa1`
    FOREIGN KEY (`reward_id`)
    REFERENCES `secondsense`.`secondsense_rewards` (`reward_id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_secondsense_rewards_has_secondsense_users_secondsense_users1`
    FOREIGN KEY (`facebook_user_id`)
    REFERENCES `secondsense`.`secondsense_users` (`facebook_user_id`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

USE `secondsense`;

DELIMITER $$

USE `secondsense`$$
DROP TRIGGER IF EXISTS `secondsense`.`avoid self_friend` $$
USE `secondsense`$$
CREATE DEFINER = CURRENT_USER TRIGGER `avoid self_friend` BEFORE INSERT ON `secondsense_friends` FOR EACH ROW 
BEGIN
	DECLARE dummy,baddata INT;
	SET baddata = 0;
	IF (NEW.facebook_user_id = NEW.facebook_user_id_friend) THEN
		SET baddata = 1;
	END IF;
	IF baddata = 1 THEN
		SELECT CONCAT('Cannot Link ', NEW.facebook_user_id, ' with himself') INTO dummy FROM information_schema.tables;
	END IF;
END$$


DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `secondsense`.`secondsense_scores`
-- -----------------------------------------------------
START TRANSACTION;
USE `secondsense`;
INSERT INTO `secondsense`.`secondsense_scores` (`score_id`, `high_score`, `game_count`, `sum_score`) VALUES (1, 24536, 15, 244536456);
INSERT INTO `secondsense`.`secondsense_scores` (`score_id`, `high_score`, `game_count`, `sum_score`) VALUES (2, 2456, 5, 465342);
INSERT INTO `secondsense`.`secondsense_scores` (`score_id`, `high_score`, `game_count`, `sum_score`) VALUES (3, 47895, 15, 789647);

COMMIT;


-- -----------------------------------------------------
-- Data for table `secondsense`.`secondsense_users`
-- -----------------------------------------------------
START TRANSACTION;
USE `secondsense`;
INSERT INTO `secondsense`.`secondsense_users` (`facebook_user_id`, `facebook_user_name`, `facebook_user_profile_picture`, `create_time`, `score_id`) VALUES ('10207942504911437', 'Jordi\' Naire', 'https://scontent.xx.fbcdn.net/hprofile-xpf1/v/t1.0-1/p50x50/12308756_10207999537937227_5054568030571087939_n.jpg?oh=51bad14a26bec42f33e67f5a3d6988bf&oe=572B4CCA', NULL, 1);
INSERT INTO `secondsense`.`secondsense_users` (`facebook_user_id`, `facebook_user_name`, `facebook_user_profile_picture`, `create_time`, `score_id`) VALUES ('10208165568158846', 'Denis Tribouillois', NULL, NULL, 2);
INSERT INTO `secondsense`.`secondsense_users` (`facebook_user_id`, `facebook_user_name`, `facebook_user_profile_picture`, `create_time`, `score_id`) VALUES ('1259753977383932', 'Armand Bto', NULL, NULL, 3);

COMMIT;


-- -----------------------------------------------------
-- Data for table `secondsense`.`secondsense_friends`
-- -----------------------------------------------------
START TRANSACTION;
USE `secondsense`;
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('1259753977383932', '10208165568158846');
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('10208165568158846', '1259753977383932');
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('10208165568158846', '10207942504911437');
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('1259753977383932', '10207942504911437');
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('10207942504911437', '10208165568158846');
INSERT INTO `secondsense`.`secondsense_friends` (`facebook_user_id`, `facebook_user_id_friend`) VALUES ('10207942504911437', '1259753977383932');

COMMIT;


-- -----------------------------------------------------
-- Data for table `secondsense`.`secondsense_rewards`
-- -----------------------------------------------------
START TRANSACTION;
USE `secondsense`;
INSERT INTO `secondsense`.`secondsense_rewards` (`reward_id`, `reward_name`, `score_condition`, `game_count_condition`) VALUES (1, 'Creators', NULL, NULL);

COMMIT;


-- -----------------------------------------------------
-- Data for table `secondsense`.`secondsense_has_reward`
-- -----------------------------------------------------
START TRANSACTION;
USE `secondsense`;
INSERT INTO `secondsense`.`secondsense_has_reward` (`reward_id`, `facebook_user_id`) VALUES (1, '10208165568158846');
INSERT INTO `secondsense`.`secondsense_has_reward` (`reward_id`, `facebook_user_id`) VALUES (1, '1259753977383932');

COMMIT;

